---
layout: post
title:  "μ•”νΈν™”"
date:   2021-07-06 17:05:21 +0800
tags: Security SpringBoot Encode
color: rgb(154,133,255)
subtitle: 'Springboot Encode'
---

## μ•”νΈν™”(Encode)

μ›Ή μ„λΉ„μ¤ κ°λ°μ— λ€ν•΄ μ μ €μ μ •λ³΄λ¥Ό μ•μ „ν•κ² μ €μ¥ν•κΈ° μ„ν•΄μ„λ” μ •λ³΄λ¥Ό μλ” κ·Έλ€λ΅ μ €μ¥ν•κΈ°λ³΄λ‹¤ μ•”νΈν™”λ¥Ό ν†µν•΄ λ³µμ΅ν• λ¬Έμμ—΄λ΅ λ³΄κ΄€ν•λ” λ°©μ‹μ΄ λ”μ± μ•μ „ν•  κ²ƒμ΄λ‹¤.
Spring Security 5.3.3 λ²„μ „μ—μ„λ” λΉ„λ°€λ²νΈ μ•”νΈν™” μΈν„°νμ΄μ¤μΈ PasswordEncoderμ™€ κµ¬ν„μ²΄λ¥Ό μ§€μ›ν•¨μΌλ΅μ„ μ •λ³΄μ μ•μ „μ •μ„ κ°•ν™” μ‹μΌ°λ‹¤.
Spring Securityμ—λ” 4κ°€μ§€μ κΈ°λ³Έ μ•”νΈν™” ν΄λμ¤λ¥Ό μ κ³µν•κ³  μλ‹¤.

> * BcryptPasswordEncoder : BCrypt ν•΄μ‹ ν•¨μ
> * Argon2PasswordEncoder : Argon2 ν•΄μ‹ ν•¨μ
> * Pbkdf2PasswordEncoder : PBKDF2 ν•΄μ‹ ν•¨μ
> * SCryptPasswordEncoder : SCrypt ν•΄μ‹ ν•¨μ

μ €μ¥λ μ•”νΈλ” λ³µνΈν™”κ°€ λ¶κ°€λ¥ν• λ‹¨λ°©ν–¥ μ•”νΈμ½”λ“λ΅ λ§λ“¤μ–΄μ Έμ•Ό ν•λ©° μ‚¬μ©μλ¥Ό μ μ™Έν• λ¨λ“  μ ‘κ·Όμκ°€ μ ‘κ·Όν•  μ μ—†λ” ν•νƒμ—¬μ•Όν•λ‹¤.
λ™μ‹μ— ν•΄μ»¤κ°€ μμΈ΅ν•  μ μ—†λ„λ΅ *Salt μ²λ¦¬*λ¥Ό ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.

> Salt μ²λ¦¬
>
> λ°μ΄ν„°, λΉ„λ°€λ²νΈ, ν†µκ³Όμ•”νΈλ¥Ό ν•΄μ‹ μ²λ¦¬ν•λ” λ‹¨λ°©ν–¥ ν•¨μμ μ¶”κ°€ μ…λ ¥μΌλ΅ μ‚¬μ©λλ” λλ¤ λ°μ΄ν„°μ΄λ‹¤.
> μ†”νΈλ” μ¤ν† λ¦¬μ§€μ—μ„ λΉ„λ°€λ²νΈλ¥Ό λ³΄νΈν•κΈ° μ„ν•΄ μ‚¬μ©λλ‹¤.
> μ—­μ‚¬μ μΌλ΅ λΉ„λ°€λ²νΈλ” μ‹μ¤ν…μ— ν‰λ¬ΈμΌλ΅ μ €μ¥λμ§€λ§ μ‹κ°„μ΄ μ§€λ‚¨μ— λ”°λΌ μ¶”κ°€μ μΈ λ³΄νΈ λ°©λ²•μ΄ κ°λ°λμ–΄
> μ‹μ¤ν…μΌλ΅λ¶€ν„° μ‚¬μ©μμ λΉ„λ°€λ²νΈ μ½κΈ°λ¥Ό λ³΄νΈν•λ‹¤.

> λ‹¨λ°©ν–¥ μ•”νΈν™” μ½”λ“
>
> λ³µνΈν™”κ°€ λ¶κ°€λ¥ν• μ•”νΈλ΅ Hash μ•κ³ λ¦¬μ¦μ„ κΈ°λ°μΌλ΅ μ•”νΈν™”κ°€ λλ‹¤.
>
> μΆ…λ¥ : MD5, SHA-1, SHA-2λ“±


### DB μ•”νΈν™” vs Spring Security μ•”νΈν™”


κ°λ° μ½”λ“ μƒμ λ³µμ΅ν•¨μ„ μ¤„μ΄κΈ° μ„ν• λ©μ μΌλ΅ DB μμ²΄μ—μ„ μ§€μ›ν•λ” μ•”νΈν™”λ¥Ό μ§€μ •ν•λ” κ²½μ°κ°€ μμ§€λ§ λ§μΌ DB Framework κ°€ λ°”λ€λ” κ²½μ° λ³µμ΅ν• μ•”νΈν™” ν”„λ΅μ„Έμ¤λ¥Ό λ‹¤μ‹ μ„¤μ •ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.

λ³µμ΅ν• μ½”λ“λ¥Ό κ°μν•λ©΄μ„κΉμ§€λ„ μ¤ν”„λ§ μ‹νλ¦¬ν‹°λ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™” λ μ •λ³΄λ¥Ό DBμ— μ €μ¥ν•κΈ° μ΄μ „μ— Springμ„ ν†µν•΄ μ•”νΈν™”λ¥Ό μ§„ν–‰μ‹μΌ μ¤€λ‹¤λ©΄
μ΄λ° λ³µμ΅ν• μ•”νΈν™” λ‹¨κ³„λ¥Ό κ°λ°μμ—­μ—μ„ μ§„ν–‰ν•κ² μ§€λ§ *ν™•μ¥μ„±*κ³Ό *μ μ§€*μ μΈ΅λ©΄μ—μ„λ” μ΄μµμ„ λ³Ό μ μλ‹¤. 


### κµ¬μ„±
 4κ°€μ§€ μ•”νΈν™” λ°©μ‹μ— λ€ν•΄ κ°™μ€ λ¬Έμλ¥Ό μ…λ ¥ν•  κ²½μ° κ°κ°μ μ•”νΈν™” λ°©μ‹μ΄ μ–΄λ–»κ² ν‘ν„λλ”μ§€ ν™•μΈν•λ‹¤.

#### build.Gradle
```
dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.7.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.7.0'
    implementation 'org.springframework.boot:spring-boot-starter-security'

    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    compile('com.h2database:h2')
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-web'

    testCompile('org.springframework.boot:spring-boot-starter-test')
}
```

#### WebSecurityConfig.class
```java
@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    // μ‚¬μ©μκ°€ μ›ν•λ” μ•”νΈν™” μΆ…λ¥ μ§€μ • κ°€λ¥
    
    @Bean
    public PasswordEncoder getPasswordEncoder() {
        return new Pbkdf2PasswordEncoder();
    }

//    @Bean
//    public PasswordEncoder getPasswordEncoder() {
//        return new BCryptPasswordEncoder();
//    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
                .cors().disable()      // cors λΉ„ν™μ„±ν™”
                .csrf().disable()      // csrf λΉ„ν™μ„±ν™”
                .formLogin().disable() //κΈ°λ³Έ λ΅κ·ΈμΈ νμ΄μ§€ μ—†μ• κΈ°
                .headers().frameOptions().disable();
    }
}
```
μ›Ή νμ΄μ§€λ΅λ¶€ν„° μ ‘κ·Όμ„ μ„¤μ •ν•λ” λ‹¨κ³„λ΅ μ„¤μ •ν•κ³ μ ν•λ” μ•”νΈν™” μΆ…λ¥λ¥Ό μ§€μ •ν•  μ μλ‹¤.


#### Controller.class
````java
@RestController
@Slf4j
@RequiredArgsConstructor
public class Controller {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    final PasswordEncoder passwordEncoder;


    @PostMapping("/api/member")
    public String saveMember(@RequestBody User memberDto) {
        String password=passwordEncoder.encode(memberDto.getPassword());
        userRepository.save(User.createUser(memberDto.getId(), password));
        return password;
    }
}
````

```json
{
    "id" : "sup2is@gmail.com",
    "password" : "user"
}
```

localhost:8080/h2-console μ— μ €μ¥λλ” λ°μ΄ν„° ν™•μΈ

|idx|id|password|
|:---:|:---:|:---:|
|1|sup2is@gmail.com	|548552419d883daeecaefaa17349d75d712c07120e87d4c219399e71e662da65cc916e9799873bdb|

---

#### ControllerTest.class
```java
@RunWith(SpringRunner.class)
public class ControllerTest {

    @Test
    public void BCryptPasswordEncoder() {
        // pw κ°•λ„ μ„¤μ • κ°€λ¥ ν„μ¬ 16
        BCryptPasswordEncoder encoder = new BCryptPasswordEncoder(16);
        String result = encoder.encode("user");

        System.out.println("BCryptPasswordEncoder : " + result);
        assertTrue(encoder.matches("user", result));
    }
    

    @Test
    public void Pbkdf2PasswordEncoder() {
        Pbkdf2PasswordEncoder encoder = new Pbkdf2PasswordEncoder();
        String result = encoder.encode("user");

        System.out.println("Pbkdf2PasswordEncoder : " + result);
        assertTrue(encoder.matches("user", result));
    }
    
}
```
> κ²°κ³Ό
> 1. Pbkdf2PasswordEncoder : dc0f4ee26f083b6e4e429043878439c79de286ba1a7a488f8ae4a738f9ed19dd7a5ea42343baf071
> 
> 2. BCryptPasswordEncoder : $2a$16$h08nnXUcMctpWGZ9Wkkw8ey7zGTgSsmDkEyb7Omia2GZwFN8nM4xm


μ•μ„ Spring μ—μ„λ” 4κ°€μ§€μ μ•”νΈν™” λ°©μ‹μ΄ μ΅΄μ¬ν•λ‹¤κ³  ν–μ§€λ§ ν…μ¤νΈ μ¤‘μ— κ°€λ¥ν• μ•”νΈν™”λ” 2κ°€μ§€ μ€λ‹¤. 


### π§ΎReference
1. [PasswordEncoderλ€?](https://velog.io/@corgi/Spring-Security-PasswordEncoder%EB%9E%80-4kkyw8gi#argon2passwordencoder)
2. [λ‹¨λ°©ν–¥ μ•”νΈν™”](https://koonsland.tistory.com/3)